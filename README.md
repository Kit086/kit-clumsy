# kit-satnet-simulator

## **用法示例**

### **0. 赋予脚本可执行权限**
运行以下命令为脚本赋予可执行权限：
```bash
sudo chmod +x configure.sh check.sh delete.sh
```

### **1. 配置网络规则**
使用 `configure.sh` 脚本配置网络规则。例如：
```bash
bash configure.sh -i ens33 -s 192.168.18.202 -d 192.168.18.204 -U 500ms -D 600ms -B 128kbps -b 512kbps -J 50ms -L 5%
```

#### 参数说明：
- **`-i`**：指定网卡名称（必填）。如 `ens33`，表示配置应用于此网卡。
- **`-s`**：指定源地址（必填）。如 `192.168.18.202`，表示流量从此地址发出。
- **`-d`**：指定目标地址（必填）。如 `192.168.18.204`，表示流量发往此地址。
- **`-U`**：设置上行延迟（可选）。如 `500ms`，表示上行流量的延迟为 500ms。
- **`-D`**：设置下行延迟（可选）。如 `600ms`，表示下行流量的延迟为 600ms。
- **`-B`**：设置上行带宽（可选）。如 `128kbps`，表示上行带宽限制为 128 Kbps。
- **`-b`**：设置下行带宽（可选）。如 `512kbps`，表示下行带宽限制为 512 Kbps。
- **`-J`**：设置延迟抖动（可选）。如 `50ms`，表示延迟的抖动范围为 ±50ms。
- **`-L`**：设置丢包率（可选）。如 `5%`，表示 5% 的流量会被丢弃。

#### 示例解释：
上面命令的含义是：
- **上行规则（从本地主机到目标服务器）：**
  - 延迟：500ms，抖动：±50ms
  - 带宽限制：128kbps
  - 丢包率：5%
- **下行规则（从目标服务器到本地主机）：**
  - 延迟：600ms，抖动：±50ms
  - 带宽限制：512kbps
  - 丢包率：5%

### **2. 检查当前网络配置**
使用 `check.sh` 脚本查看当前网络配置：
```bash
bash check.sh -i ens33
```

#### 参数说明：
- **`-i`**：指定网卡名称（必填）。如 `ens33`，表示检查该网卡上的配置。

#### 输出示例：
执行后会显示：
- **上行规则**：当前网卡（如 `ens33`）的 `tc qdisc` 和 `tc class` 配置。
- **下行规则**：虚拟接口 `ifb0` 上的 `tc qdisc` 和 `tc class` 配置。
- **iptables 规则**：`mangle` 表中的流量标记规则。

### **3. 删除网络配置**
使用 `delete.sh` 脚本清理所有网络限制：
```bash
bash delete.sh -i ens33
```

#### 参数说明：
- **`-i`**：指定网卡名称（必填）。如 `ens33`，表示清理此网卡上的所有网络限制。

#### 功能描述：
- 清除网卡 `ens33` 上的上行规则。
- 清除虚拟接口 `ifb0` 上的下行规则。
- 删除 `iptables` 中的流量标记规则。
- 关闭虚拟接口 `ifb0`。

### **完整使用流程**

#### 配置网络规则：
```bash
bash configure.sh -i ens33 -s 192.168.18.202 -d 192.168.18.204 -U 500ms -D 600ms -B 128kbps -b 512kbps -J 50ms -L 5%
```

#### 检查配置：
```bash
bash check.sh -i ens33
```

#### 删除配置：
```bash
bash delete.sh -i ens33
```

## TODO

- [ ] 目前上行和下行的带宽、延迟、丢包率等参数是一致的，可以考虑分别配置，以更加贴近真实网络环境
- [ ] 无法模拟动态变化的网络环境（如突发拥塞、瞬时抖动等）

## Other

如果需要更复杂的动态网络条件，可以考虑搭配专用的网络测试工具，如 Chaos Mesh 或 WANem。
